<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Painel Administrativo - Estética Automotiva</title>
<style>
  /* Reset básico */
  * {
    box-sizing: border-box;
  }
  body {
    font-family: Arial, sans-serif;
    margin: 0; 
    padding: 20px;
    background: #f0f4f8;
    color: #333;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: flex-start;
  }
  #login-container, #admin-container {
    width: 100%;
    max-width: 900px;
    background: white;
    padding: 20px 25px;
    border-radius: 10px;
    box-shadow: 0 0 18px rgba(0,0,0,0.12);
  }
  #admin-container {
    display: none;
    flex-direction: column;
  }
  h1 {
    text-align: center;
    color: #002b45;
    margin-bottom: 25px;
    font-size: 1.5rem;
  }
  label {
    display: block;
    margin: 12px 0 6px;
    font-weight: 600;
    font-size: 1rem;
  }
  input[type="password"], input[type="text"], textarea {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
    transition: border-color 0.3s;
  }
  input[type="password"]:focus, input[type="text"]:focus, textarea:focus {
    border-color: #005b8a;
    outline: none;
  }
  button {
    cursor: pointer;
    border: none;
    border-radius: 8px;
    font-weight: 700;
    transition: background-color 0.3s;
  }
  button.primary {
    background-color: #002b45;
    color: white;
    padding: 12px 18px;
    font-size: 1rem;
  }
  button.primary:hover {
    background-color: #005b8a;
  }
  button.danger {
    background-color: #dc3545;
    color: white;
    padding: 8px 14px;
    font-size: 0.9rem;
  }
  button.danger:hover {
    background-color: #a71d2a;
  }
  button.success {
    background-color: #25d366;
    color: white;
    padding: 8px 14px;
    font-size: 0.9rem;
  }
  button.success:hover {
    background-color: #1ebe57;
  }
  button.secondary {
    background-color: #6c757d;
    color: white;
    padding: 8px 14px;
    font-size: 0.9rem;
  }
  button.secondary:hover {
    background-color: #565e64;
  }
  .error {
    color: red;
    margin-top: 12px;
    font-weight: 700;
    font-size: 0.9rem;
    text-align: center;
  }
  #btn-logout {
    background: #dc3545;
    color: #fff;
    padding: 10px 20px;
    border-radius: 8px;
    font-weight: 700;
    cursor: pointer;
    margin-bottom: 20px;
    width: 140px;
    align-self: flex-end;
  }
  #btn-logout:hover {
    background: #a71d2a;
  }

  /* Abas */
  .tabs {
    display: flex;
    border-bottom: 2px solid #ccc;
    margin-bottom: 20px;
    user-select: none;
  }
  .tab {
    padding: 12px 25px;
    cursor: pointer;
    font-weight: 700;
    color: #002b45;
    border: 2px solid transparent;
    border-bottom: none;
    margin-right: 8px;
    border-radius: 8px 8px 0 0;
    background-color: #e7edf4;
    transition: background-color 0.3s, border-color 0.3s;
  }
  .tab.active {
    background-color: white;
    border-color: #002b45;
    border-bottom: 2px solid white;
  }
  
  /* Tabelas */
  table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.9rem;
  }
  th, td {
    padding: 8px 10px;
    border: 1px solid #ccc;
    text-align: left;
    vertical-align: middle;
    word-break: break-word;
  }
  th {
    background-color: #002b45;
    color: white;
    font-weight: 700;
  }
  tbody tr:nth-child(even) {
    background-color: #f7fafd;
  }
  .actions {
    display: flex;
    gap: 5px;
    flex-wrap: wrap;
  }

  /* Responsividade */
  @media(max-width: 820px) {
    #admin-container {
      max-width: 100%;
      padding: 15px 10px;
    }
    table, thead, tbody, th, td, tr {
      display: block;
      width: 100%;
    }
    thead tr {
      position: absolute;
      top: -9999px;
      left: -9999px;
    }
    tr {
      margin-bottom: 20px;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 12px 10px;
      background: white;
    }
    td {
      border: none;
      padding-left: 50%;
      position: relative;
      text-align: left;
      font-size: 0.9rem;
      white-space: normal;
      word-wrap: break-word;
      padding-top: 8px;
      padding-bottom: 8px;
    }
    td::before {
      position: absolute;
      top: 50%;
      left: 15px;
      width: 45%;
      padding-right: 10px;
      white-space: nowrap;
      transform: translateY(-50%);
      font-weight: 700;
      content: attr(data-label);
      color: #555;
      font-size: 0.9rem;
    }
    .actions {
      justify-content: flex-start;
      gap: 8px;
    }
    #btn-logout {
      width: 100%;
      max-width: none;
      margin-bottom: 15px;
    }
  }
</style>
</head>
<body>

<div id="login-container" aria-label="Formulário de login">
  <h1>Login Administrativo</h1>
  <form id="login-form">
    <label for="senha">Senha:</label>
    <input type="password" id="senha" name="senha" required autocomplete="current-password" />
    <button type="submit" class="primary">Entrar</button>
    <div class="error" id="login-error" role="alert" aria-live="assertive" style="display:none;"></div>
  </form>
</div>

<div id="admin-container" aria-label="Painel administrativo">
  <h1>Painel Administrativo - Estética Automotiva</h1>
  <button id="btn-logout" title="Sair do painel">Sair</button>

  <div class="tabs" role="tablist">
    <div class="tab active" role="tab" aria-selected="true" tabindex="0" id="tab-agendamentos" aria-controls="panel-agendamentos">Agendamentos</div>
  </div>

  <!-- Painel Agendamentos -->
  <section id="panel-agendamentos" role="tabpanel" aria-labelledby="tab-agendamentos">
    <table aria-label="Tabela de agendamentos">
      <thead>
        <tr>
          <th>Nome</th>
          <th>Telefone</th>
          <th>Serviço</th>
          <th>Data</th>
          <th>Observações</th>
          <th>Status</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody id="agendamentos-body">
        <!-- Linhas geradas por JS -->
      </tbody>
    </table>
  </section>

</div>

<script>
  const SENHA_CORRETA = "123";

  const loginContainer = document.getElementById('login-container');
  const adminContainer = document.getElementById('admin-container');
  const loginForm = document.getElementById('login-form');
  const loginError = document.getElementById('login-error');
  const btnLogout = document.getElementById('btn-logout');

  const tabAgendamentos = document.getElementById('tab-agendamentos');
  const panelAgendamentos = document.getElementById('panel-agendamentos');

  // Estado atual
  let agendamentos = JSON.parse(localStorage.getItem("agendamentos") || "[]");

  // Autenticação
  function estaLogado() {
    return localStorage.getItem("logadoAdmin") === "true";
  }

  function mostrarAdmin() {
    loginContainer.style.display = 'none';
    adminContainer.style.display = 'flex';
    carregarAgendamentos();
  }

  function mostrarLogin() {
    loginContainer.style.display = 'block';
    adminContainer.style.display = 'none';
  }

  if (estaLogado()) {
    mostrarAdmin();
  } else {
    mostrarLogin();
  }

  loginForm.addEventListener('submit', e => {
    e.preventDefault();
    const senha = document.getElementById('senha').value.trim();

    if (senha === SENHA_CORRETA) {
      localStorage.setItem("logadoAdmin", "true");
      mostrarAdmin();
      loginError.style.display = 'none';
      loginForm.reset();
    } else {
      loginError.textContent = "Senha incorreta.";
      loginError.style.display = 'block';
    }
  });

  btnLogout.addEventListener('click', () => {
    localStorage.removeItem("logadoAdmin");
    mostrarLogin();
  });

  // Carregar agendamentos na tabela
  function carregarAgendamentos() {
    agendamentos = JSON.parse(localStorage.getItem("agendamentos") || "[]");
    const tbody = document.getElementById("agendamentos-body");
    tbody.innerHTML = "";

    if (agendamentos.length === 0) {
      tbody.innerHTML = `<tr><td colspan="7" style="text-align:center; padding:20px; color:#666;">Nenhum agendamento encontrado.</td></tr>`;
      return;
    }

    agendamentos.forEach((agendamento, index) => {
      const tr = document.createElement("tr");

      tr.innerHTML = `
        <td data-label="Nome">${agendamento.nome}</td>
        <td data-label="Telefone">${agendamento.telefone}</td>
        <td data-label="Serviço">${agendamento.servico}</td>
        <td data-label="Data">${agendamento.data}</td>
        <td data-label="Observações">${agendamento.obs || '-'}</td>
        <td data-label="Status">
          <select aria-label="Status do agendamento" data-index="${index}">
            <option value="Pendente" ${agendamento.status === "Pendente" ? "selected" : ""}>Pendente</option>
            <option value="Confirmado" ${agendamento.status === "Confirmado" ? "selected" : ""}>Confirmado</option>
            <option value="Concluído" ${agendamento.status === "Concluído" ? "selected" : ""}>Concluído</option>
            <option value="Cancelado" ${agendamento.status === "Cancelado" ? "selected" : ""}>Cancelado</option>
          </select>
        </td>
        <td class="actions" data-label="Ações">
          <button class="primary update-btn" data-index="${index}" aria-label="Atualizar status do agendamento">Atualizar</button>
          <button class="success whatsapp-btn" data-index="${index}" aria-label="Enviar mensagem no WhatsApp">WhatsApp</button>
          <button class="danger delete-btn" data-index="${index}" aria-label="Excluir agendamento">Excluir</button>
        </td>
      `;
      tbody.appendChild(tr);
    });

    tbody.querySelectorAll('select').forEach(sel => {
      sel.addEventListener('change', (e) => {
        const idx = e.target.getAttribute('data-index');
        atualizarStatus(idx, e.target.value, false);
      });
    });

    tbody.querySelectorAll('.update-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.target.getAttribute('data-index');
        const select = tbody.querySelector(`select[data-index="${idx}"]`);
        atualizarStatus(idx, select.value, true);
      });
    });

    tbody.querySelectorAll('.whatsapp-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.target.getAttribute('data-index');
        enviarWhatsApp(idx);
      });
    });

    tbody.querySelectorAll('.delete-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        const idx = e.target.getAttribute('data-index');
        if (confirm("Deseja realmente excluir este agendamento?")) {
          excluirAgendamento(idx);
        }
      });
    });
  }

  function atualizarStatus(index, novoStatus, showAlert) {
    agendamentos[index].status = novoStatus;
    localStorage.setItem("agendamentos", JSON.stringify(agendamentos));
    if (showAlert) alert(`Status atualizado para "${novoStatus}".`);
  }

  function enviarWhatsApp(index) {
    const ag = agendamentos[index];
    if (!ag) return;

    const msg = `Olá ${ag.nome}, o status do seu agendamento para "${ag.servico}" em ${ag.data} foi atualizado para: ${ag.status}. Qualquer dúvida, estamos à disposição!`;
    const telefone = ag.telefone.replace(/\D/g, '');

    const url = `https://wa.me/55${telefone}?text=${encodeURIComponent(msg)}`;
    window.open(url, '_blank');
  }

  function excluirAgendamento(index) {
    agendamentos.splice(index, 1);
    localStorage.setItem("agendamentos", JSON.stringify(agendamentos));
    carregarAgendamentos();
  }
</script>

</body>
</html>
